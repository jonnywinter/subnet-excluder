#--- Documentation
#------ RFC Reserved ranges - https://www.rfc-editor.org/rfc/rfc6890

from ipaddress import ip_network, collapse_addresses
import json

def findSubnets(largerSubnet, excludedSubnets):
    for excludedSubnet in excludedSubnets:
        excludedSubnet = ip_network(excludedSubnet)
        newSubnets = []
        for sub in largerSubnet:
            if excludedSubnet.subnet_of(sub):
                newSubnets.extend(list(sub.address_exclude(excludedSubnet)))
            else:
                newSubnets.append(sub)
        largerSubnet = newSubnets
    return list(collapse_addresses(newSubnets))

ipv4ReservedRanges = ['0.0.0.0/8','10.0.0.0/8','100.64.0.0/10','127.0.0.0/8','169.254.0.0/16','172.16.0.0/12','192.0.0.0/24','192.0.2.0/24','192.88.99.0/24','192.168.0.0/16','198.18.0.0/15','198.51.100.0/24','203.0.113.0/24','224.0.0.0/4','240.0.0.0/4']
exclusions = [
    '13.248.183.85',
    '15.197.188.79',
    '3.33.180.249',
    '34.249.56.200',
    '34.249.66.145',
    '34.250.95.109',
    '34.252.248.172',
    '34.253.21.48',
    '34.253.45.80',
    '52.213.142.143',
    '54.170.197.44',
    '54.194.100.128',
    '54.194.153.16',
    '54.194.17.228',
    '54.194.217.74',
    '54.194.218.239',
    '54.194.242.0',
    '54.194.245.26',
    '54.194.25.164',
    '54.194.42.15',
    '54.194.50.12',
    '54.194.54.213',
    '54.194.55.167',
    '54.194.59.222',
    '54.194.70.100',
    '54.194.73.199',
    '54.194.74.127',
    '54.194.87.166',
    '54.216.209.93',
    '54.77.66.30',
    '75.2.6.70',
    '76.223.59.231',
    '99.83.233.223',
    '18.202.215.160',
    '3.251.48.174',
    '52.210.155.229',
    '3.74.13.184',
    '3.123.193.160',
    '18.157.202.135',
    '18.185.3.89',
    '18.198.200.249',
    '18.198.217.209',
    '34.255.30.57',
    '52.28.142.189',
    '52.28.143.32',
    '52.29.179.182',
    '54.93.63.109',
    '54.93.70.139',
    '34.249.11.108',
    '34.249.107.133',
    '34.252.65.215',
    '34.253.141.153',
    '34.254.83.6',
    '34.255.142.98',
    '52.17.144.57',
    '54.72.134.204',
    '54.72.228.106',
    '54.76.210.230',
    '54.77.1.79',
    '54.77.25.238',
    '54.77.29.239',
    '54.246.118.170',
    '63.33.39.246',
    '63.35.143.99',
    '99.81.143.245',
    '15.160.37.74',
    '15.161.26.111',
    '18.102.39.74'
]
result = findSubnets([ip_network('0.0.0.0/0')], ipv4ReservedRanges + exclusions)

ips = []
for i in result:
    ips.append(str(i))

with open('ips.json','w') as f:
    json.dump(ips, f)